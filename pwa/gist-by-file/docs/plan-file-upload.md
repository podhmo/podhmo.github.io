# ファイルアップロード機能実装計画

## 目的

スマホのクリップボード制限を超えて、複数ファイルをGistに直接アップロードできる機能を実装する。

## 現状

- GitHubログイン機能: ✅ 完了
- エラーハンドリング: ✅ 完了
- 基本的なUI/UX: ✅ 完了

## 今回実装する機能

### 1. ファイルアップロード機能

- **複数ファイル対応**: `multiple` 属性付きの`<input type="file">`
- **モバイルファーストUI**: スマホでの操作性を最優先（D&D機能は除外）
- **プレビュー機能**: アップロード前にファイル内容とメタデータを表示

### 2. Gist作成機能

- **新規Gist作成のみ** (今回のスコープ)
- **ファイル名保持**: 元のファイル名をそのまま使用
- **複数ファイル対応**: 1つのGistに複数ファイルをまとめて作成

### 3. UI/UX改善（モバイル重視）

- **タッチ操作最適化**: 大きなタップエリア、指に優しいサイズ
- **プログレス表示**: アップロード中の状態表示
- **成功/失敗フィードバック**: 作成完了後のGist URLの表示
- **レスポンシブデザイン**: スマホ→タブレット→デスクトップの順で最適化

## 技術仕様

### フロントエンド

```typescript
// 新しいコンポーネント
- FileUploadForm: ファイル選択・プレビュー
- FilePreview: ファイル内容の確認
- GistCreationProgress: 作成プロセスの進行状況
- GistResult: 作成完了後の結果表示
```

### バックエンド API

```typescript
// 新しいルート
POST /api/gist/create
- リクエスト: multipart/form-data (複数ファイル)
- レスポンス: { success: boolean, gist_url?: string, error?: string }

// GitHub API連携
- GitHub Gists API v3を使用
- 必要なスコープ: "gist" (現在は "read:user" のみ)
```

### データフロー

1. **ファイル選択**: ユーザーがファイルを選択/ドロップ
2. **プレビュー**: ファイル内容をフロントエンドで表示
3. **アップロード**: サーバーに複数ファイルを送信
4. **Gist作成**: GitHub APIでGistを作成
5. **結果表示**: 作成されたGist URLを表示

## 実装手順

### Phase 1: UI基盤 (30分)

1. ファイルアップロードフォームの作成
2. ドラッグ&ドロップエリアの実装
3. ファイルプレビュー機能の実装

### Phase 2: サーバー側処理 (45分)

1. multipart/form-dataの処理
2. GitHub API連携 (Gist作成)
3. エラーハンドリングの強化

### Phase 3: 統合・テスト (30分)

1. フロントエンドとバックエンドの連携
2. エラーケースのテスト
3. モバイルでの動作確認

## 必要な変更

### GitHub OAuth Scope

```diff
- scope: "read:user"
+ scope: "read:user,gist"
```

### 依存関係追加

```json
// 必要に応じて追加検討
// - ファイルタイプ判定ライブラリ
// - プログレスバー用CSS/JS
```

### 新しいファイル構成

```
main.tsx (既存)
├── 認証機能 (既存)
├── ファイルアップロード処理 (新規)
├── Gist作成API (新規)
└── エラーハンドリング (拡張)
```

## Future Work (今回の範囲外)

- [ ] 既存Gist更新機能
- [ ] Gist URLを指定した更新
- [ ] ファイルの削除機能
- [ ] Gist履歴管理
- [ ] オフライン対応 (PWA)

## 制約・考慮事項

### モバイルファースト設計

- **主要ターゲット**: スマートフォンユーザー（iPhone/Android）
- **タッチ操作**: 最小44px以上のタップターゲットサイズ
- **ビューポート**: 320px〜の狭い画面を基本とした設計
- **ネットワーク**: モバイル回線を考慮した軽量化
- **除外機能**: ドラッグ&ドロップ（モバイルで使いにくい）

### セキュリティ

- ファイルサイズ制限: GitHub Gistの制限に準拠
- ファイルタイプ制限: 実行可能ファイルの除外検討
- アップロードレート制限: GitHub API制限の考慮

### UX（モバイル重視）

- **操作性**: 片手操作を想定した配置
- **フィードバック**: タッチ操作への即座な反応
- **プログレス表示**: 長時間処理への安心感提供
- **エラーハンドリング**: 分かりやすく簡潔なメッセージ

### パフォーマンス（モバイル考慮）

- JavaScript最小化: Optional Chaining等の新機能は避ける
- 大容量ファイルの分割処理検討
- モバイル回線での処理時間最適化

## 成功基準

- [ ] 複数ファイルを選択してGistを作成できる
- [ ] 元のファイル名が保持される
- [ ] スマホから快適に操作できる
- [ ] エラー時に適切なフィードバックがある
- [ ] 作成されたGist URLが表示される

---

**推定実装時間**: 約2時間 **優先度**: High **リスク**: Medium (GitHub
API制限、ファイルサイズ制限)
