<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Studio Conversion History Downloader</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css" />
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <main class="container">
        <header>
            <h1>AI Studio Conversion History Downloader</h1>
            <p>Google AI Studio フォルダ内の JSON ファイルをダウンロードします。</p>
        </header>

        <nav>
            <ul>
                <li><button id="authorize_button" style="display:none;">Googleアカウントでログイン</button></li>
                <li><button id="signout_button" style="display:none;">ログアウト</button></li>
            </ul>
        </nav>

        <section id="content" style="display:none;">
            <!-- URL指定ダウンロードセクション -->
            <article>
                <header>
                    <h2>URLから直接ダウンロード</h2>
                </header>
                <p>AI Studio の URL を入力して、直接ダウンロードできます。</p>
                <form id="url-download-form">
                    <label for="url-input">
                        AI Studio URL:
                        <input type="text" id="url-input" name="url-input" placeholder="https://aistudio.google.com/prompts/1-UCiE72JzsfPU5YzE0KVHj5MynEyKbQ5">
                    </label>
                    <div style="display: flex; gap: 1rem;">
                        <button type="submit">JSON形式でダウンロード</button>
                        <button type="button" id="url-download-md-button">MD形式でダウンロード</button>
                    </div>
                </form>
                <p id="url-status-message" style="display:none;"></p>
            </article>

            <hr>

            <h2>ファイル一覧 (Google AI Studio フォルダ内)</h2>

            <!-- ダウンロードオプションを追加 -->
            <fieldset>
                <legend>Markdownダウンロードオプション</legend>
                <label for="includeThoughtsCheckbox">
                    <input type="checkbox" id="includeThoughtsCheckbox" name="includeThoughtsCheckbox" role="switch" checked>
                    AIの思考プロセスを含める
                </label>
                <label for="onlyUserInputsCheckbox">
                    <input type="checkbox" id="onlyUserInputsCheckbox" name="onlyUserInputsCheckbox" role="switch">
                    ユーザー入力のみ表示する
                </label>
            </fieldset>
            <!-- /ダウンロードオプション -->

            <div id="file-list-container">
                <p aria-busy="true" id="loading-message" style="display:none;">ファイル一覧を読み込み中...</p>
                <ul id="file-list"></ul>
                <p id="no-files-message" style="display:none;">対象のファイルが見つかりませんでした。</p>
            </div>
        </section>
        
        <footer>
            <small>Pico.css v2 を使用しています。</small>
        </footer>
    </main>

    <script type="module" src="script.js"></script>
</body>
</html>